generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String   @default("")
  role      String   @default("TEACHER")
  classes   Class[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Class {
  id          String    @id @default(cuid())
  name        String
  period      String?
  accessCode  String    @unique
  description String?
  teacherId   String
  teacher     User      @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  students    Student[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Student {
  id                 String              @id @default(cuid())
  firstName          String
  lastName           String
  name               String              @default("")
  studentId          String?             @unique
  classId            String
  class              Class               @relation(fields: [classId], references: [id], onDelete: Cascade)
  riskLevel          String              @default("LOW")
  lastMastery        Float               @default(0.0)
  assessmentSessions AssessmentSession[]
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
}

model AssessmentSession {
  id           String     @id @default(cuid())
  studentId    String
  student      Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)
  startTime    DateTime   @default(now())
  endTime      DateTime?
  status       String     @default("IN_PROGRESS")
  currentTheta Float      @default(0.0)
  responses    Response[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Item {
  id                 String     @id @default(cuid())
  content            String
  options            Json
  correctAnswer      String
  standard           String
  difficulty_b       Float
  discrimination_a   Float      @default(1.0)
  guessing_c         Float      @default(0.0)
  responses          Response[]
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
}

model Response {
  id             String            @id @default(cuid())
  sessionId      String
  session        AssessmentSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  itemId         String
  item           Item              @relation(fields: [itemId], references: [id], onDelete: Cascade)
  selectedAnswer String
  isCorrect      Boolean
  timeSpent      Int
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
}
